<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
		<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<!--
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		-->
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css">
		

		<link rel="stylesheet" href="../css/existingreview.css">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<div class="container-fluid">
			<a class="navbar-brand" href="index.html">CodeReview</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item">
					<a class="nav-link active" aria-current="page" href="/">Home</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					Changes
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					<li><a class="dropdown-item" href="#">Open</a></li>
					<li><a class="dropdown-item" href="#">Approved</a></li>
					<li><a class="dropdown-item" href="#">Time Exceeded</a></li>
					</ul>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#">Repos</a>
				</li>
				</ul>
				<form class="d-flex" action="/logout" method="post">
				<button class="btn btn-primary" type="submit">Logout</button>
				</form>
			</div>
			</div>
		</nav>
		<div class="container d-flex flex-column" style="gap: 50px;">
			<div>
				<h1 class="rev-title"><%= revTitle %></h1>
				<h3 class="section-title">Author:</h3>
				<ul class="list-group list-group-flush">
					<li class="list-group-item"><%= authorName %></li>
				</ul>
			</div>
			<div>
				<h3 class="section-title">Reviewers:</h3>
				<ul class="list-group list-group-horizontal">
					<% if (typeof assignedReviewers != 'undefined') { %>
					<% for(var i=0; i < assignedReviewers.length; i++) { %>
						<li class="list-group-item">
						<%= assignedReviewers[i] %>
						</li>
					<% } %>
					<% } %>
					<!--
					<li class="list-group-item">Reviewer 1</li>
					<li class="list-group-item">Reviewer 2</li>
					<li class="list-group-item">Reviewer 3</li>
					<li class="list-group-item">Reviewer 4</li>
					<li class="list-group-item">Reviewer 5</li>
					-->
				</ul>
			</div>
			<div>
				Tags:<br /> <%= tagsStr %>
			</div>
			<div style="margin-bottom: 30px;">
				Code:
				<div class="code-block" id="code">
					<pre><code class="language-js"><textarea disabled><%= lastReviewCode %></textarea></code>
					</pre>
				</div>
			</div>

			<!-- Comments Section -->
			<div class="comments-wrapper">
				<div class="header-wrapper">
					<h1 class="table-name">Comments</h1>
				</div>
				<% for(var i=0; i < reviewComments.length; i++) { %>
				<div class="comment-wrapper">
					<div class="author-wrapper">
						<h2 class="author-name"><%= userDetails[i].username %></h2>
					</div>

					<div class="content-wrapper">
						<p class="content-text"><%- reviewComments[i].content %></p>
						<!--
						<div class="code-block" id="code">
							<pre><code class="language-js"><textarea disabled>document.getElementById("demo").innerHTML = 10.50;</textarea></code></pre>
						</div>
						-->
					</div>

					<div class="date-wrapper">
						<p class="date-text"><%= reviewComments[i].date %></p>
					</div>
				</div>
					<% if(i != reviewComments.length-1) { %>
						<div class="breakline"></div>
					<% } %>
				<% } %>
				
			</div>


			<!-- Add Comment Box -->
			<form class="add-comment-wrapper" action="/existingreview/<%= revID %>" method="post">
				<div class="codeButton">
					<button class="btn btn-sm btn-primary" id="codeButton" type="button">CODE</button>
				</div>
				<div class="comment-box-wrapper">
					<textarea id="commentText" class="comment-box" placeholder="Write your comment here..." role="textbox" name="commentText" contenteditable></textarea>
				</div>
				<div class="rate-wrapper">
					<h1 class="rate-title">Code-Review:</h1>
					<div class="rate-options">
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio1" value="-2">
							<label class="form-check-label grey" for="radio1">-2</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio2" value="-1">
							<label class="form-check-label grey" for="radio2">-1</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio3" value="0">
							<label class="form-check-label grey" for="radio3">0</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio4" value="+1">
							<label class="form-check-label grey" for="radio4">+1</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio5" value="+2">
							<label class="form-check-label grey" for="radio5">+2</label>
						</div>
					</div>
				</div>
				<button type="submit" class="add-button">Add Comment</button>
			</form>
		</div>
		<script>
			document.getElementById("codeButton").onclick = () => {
            let txt = document.getElementById("commentText");
            if(txt.selectionStart == txt.selectionEnd)
            {
                return;
            }
            const before = txt.value.substring(0, txt.selectionStart);
            const sel = txt.value.substring(txt.selectionStart, txt.selectionEnd);
            const after = txt.value.substring(txt.selectionEnd);
            txt.value = `${before}<pre><code class="language-js">${sel}</code></pre>${after}`;
        }; 
		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
	</body>
</html>