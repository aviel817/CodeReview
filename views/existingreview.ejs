<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
		<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
		<!--
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
		-->
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css">
		

		<link rel="stylesheet" href="../css/existingreview.css">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<div class="container-fluid">
			  <a class="navbar-brand" href="/">GamiRev</a>
			  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			  </button>
			  <div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				  <li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
					  Changes
					</a>
					<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
					  <li><a class="dropdown-item" href="#">Open</a></li>
					  <li><a class="dropdown-item" href="#">Approved</a></li>
					  <li><a class="dropdown-item" href="#">Abandoned</a></li>
					</ul>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" href="#">Projects</a>
				  </li>
				  <li class="nav-item">
					<a class="nav-link" href="/leaderboard">Leaderboard</a>
				  </li>
				</ul>
				<form class="d-flex">
				  <div style="width: 100px; height:45px;">
				  <a href="/createNewReview">
					<img alt="Create New Review" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20512%20512%22%3E%3Cpath%20d%3D%22M0%20256C0%20114.6%20114.6%200%20256%200C397.4%200%20512%20114.6%20512%20256C512%20397.4%20397.4%20512%20256%20512C114.6%20512%200%20397.4%200%20256zM256%20368C269.3%20368%20280%20357.3%20280%20344V280H344C357.3%20280%20368%20269.3%20368%20256C368%20242.7%20357.3%20232%20344%20232H280V168C280%20154.7%20269.3%20144%20256%20144C242.7%20144%20232%20154.7%20232%20168V232H168C154.7%20232%20144%20242.7%20144%20256C144%20269.3%20154.7%20280%20168%20280H232V344C232%20357.3%20242.7%20368%20256%20368z%22%2F%3E%3C%2Fsvg%3E"
					width="100" height="45">
				 </a>
				</div>
				  <div style="width: 100px; height: 25px; margin-top: 5px;">
				  <a href="#">
					<img alt="Notifications" src="data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3E%3C!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M256 32V51.2C329 66.03 384 130.6 384 208V226.8C384 273.9 401.3 319.2 432.5 354.4L439.9 362.7C448.3 372.2 450.4 385.6 445.2 397.1C440 408.6 428.6 416 416 416H32C19.4 416 7.971 408.6 2.809 397.1C-2.353 385.6-.2883 372.2 8.084 362.7L15.5 354.4C46.74 319.2 64 273.9 64 226.8V208C64 130.6 118.1 66.03 192 51.2V32C192 14.33 206.3 0 224 0C241.7 0 256 14.33 256 32H256zM224 512C207 512 190.7 505.3 178.7 493.3C166.7 481.3 160 464.1 160 448H288C288 464.1 281.3 481.3 269.3 493.3C257.3 505.3 240.1 512 224 512z'/%3E%3C/svg%3E"
					width="100" height="25">
				  </a>
				</div>
				</form>
				<form class="d-flex" action="/logout" method="post">
				  <button class="btn btn-primary" type="submit">Logout</button>
				</form>
			  </div>
			</div>
		  </nav>
		<div class="container d-flex flex-column" style="gap: 50px;">
			<div>
				<h1 class="rev-title"><%= revTitle %></h1>
				<h3 class="section-title">Author:</h3>
				<ul class="list-group list-group-flush">
					<li class="list-group-item"><%= authorName %></li>
				</ul>
			</div>
			<div>
				<h3 class="section-title">Reviewers:</h3>
				<ul class="list-group list-group-horizontal">
					<% if (typeof assignedReviewers_names != 'undefined') { %>
					<% for(var i=0; i < assignedReviewers_names.length; i++) { %>
						<li class="list-group-item">
						<%= assignedReviewers_names[i] %>
						</li>
					<% } %>
					<% } %>
					<!--
					<li class="list-group-item">Reviewer 1</li>
					<li class="list-group-item">Reviewer 2</li>
					<li class="list-group-item">Reviewer 3</li>
					<li class="list-group-item">Reviewer 4</li>
					<li class="list-group-item">Reviewer 5</li>
					-->
				</ul>
			</div>
			<div>
				Tags:<br /> <%= tagsStr %>
			</div>
			<div style="margin-bottom: 30px;">
				Code:
				<div class="code-block" id="code">
					<pre><code class="language-js"><textarea disabled><%= lastReviewCode %></textarea></code>
					</pre>
				</div>
			</div>

			<!-- Comments Section -->
			<div class="comments-wrapper">
				<div class="header-wrapper">
					<h1 class="table-name">Comments</h1>
				</div>
				<% for(var i=0; i < reviewComments.length; i++) { %>
				<div class="comment-wrapper">
					<div class="author-wrapper">
						<h2 class="author-name"><%= userDetails[i].username %></h2>
					</div>

					<div class="content-wrapper">
						<p class="content-text"><%- reviewComments[i].content %></p>
						<!--
						<div class="code-block" id="code">
							<pre><code class="language-js"><textarea disabled>document.getElementById("demo").innerHTML = 10.50;</textarea></code></pre>
						</div>
						-->
					</div>

					<div class="date-wrapper">
						<p class="date-text"><%= reviewComments[i].date %></p>
					</div>
				</div>
					<% if(i != reviewComments.length-1) { %>
						<div class="breakline"></div>
					<% } %>
				<% } %>
				
			</div>


			<!-- Add Comment Box -->
			<form class="add-comment-wrapper" action="/existingreview/<%= revID %>" method="post">
				<div class="codeButton">
					<button class="btn btn-sm btn-primary" id="codeButton" type="button">CODE</button>
				</div>
				<div class="comment-box-wrapper">
					<textarea id="commentText" class="comment-box" placeholder="Write your comment here..." role="textbox" name="commentText" contenteditable></textarea>
				</div>
				<div class="rate-wrapper">
					<h1 class="rate-title">Code-Review:</h1>
					<div class="rate-options">
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio1" value="-2">
							<label class="form-check-label grey" for="radio1">-2</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio2" value="-1">
							<label class="form-check-label grey" for="radio2">-1</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio3" value="0">
							<label class="form-check-label grey" for="radio3">0</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio4" value="+1">
							<label class="form-check-label grey" for="radio4">+1</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="radioRate" id="radio5" value="+2">
							<label class="form-check-label grey" for="radio5">+2</label>
						</div>
					</div>
				</div>
				<button type="submit" class="add-button">Add Comment</button>
			</form>
		</div>
		<script>
			document.getElementById("codeButton").onclick = () => {
            let txt = document.getElementById("commentText");
            if(txt.selectionStart == txt.selectionEnd)
            {
                return;
            }
            const before = txt.value.substring(0, txt.selectionStart);
            const sel = txt.value.substring(txt.selectionStart, txt.selectionEnd);
            const after = txt.value.substring(txt.selectionEnd);
            txt.value = `${before}<pre><code class="language-js">${sel}</code></pre>${after}`;
        }; 
		</script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
	</body>
</html>